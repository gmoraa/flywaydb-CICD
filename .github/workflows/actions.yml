name: CICD

on:
  push:
    branches: [ main ]

jobs:
  run_migration_test:
    name: Run Flyway migrations
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Install flyway
        run: wget -qO- https://repo1.maven.org/maven2/org/flywaydb/flyway-commandline/8.0.0/flyway-commandline-8.0.0-linux-x64.tar.gz | tar xz && sudo ln -s `pwd`/flyway-8.0.0/flyway /usr/local/bin
      - name: Run database migrations
        #run: flyway -url=jdbc:postgresql://$RDS_URL -user=$RDS_USER -password=$RDS_PASSWORD migrate
        run: echo $RDS_URL
        env:
          RDS_URL: ${{ secrets.RDS_URL }}
          RDS_USER: ${{ secrets.RDS_USER }}
          RDS_PASSWORD: ${{ secrets.RDS_PASSWORD }}
      #- name: Run database migrations
      #  run: ./migration.sh ${{ secrets.RDS_URL }} ${{ secrets.RDS_USER }} ${{ secrets.RDS_PASSWORD }}